(this["webpackJsonpfimme-admin"]=this["webpackJsonpfimme-admin"]||[]).push([[0],{100:function(e,a,t){},107:function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),c=t(8),l=t.n(c),o=(t(100),t(62)),i=t(29),m=t(76),u=t(170),s=t(57),d=t(14),f=t(65),b=t(153),g=t(156),E=t(154),h=t(155),p=t(172),v=t(157),O=t(158),C=t(175),j=t(77),k=t(73),w=t.n(k),x=t(78),y=Object(n.createContext)(),S=new x.a,N=S.get("fimme-server"),W=null,U=null,F=null,T=S.get("fimme-token"),I=!1;function L(e){var a=this,t=Object(s.b)().enqueueSnackbar,c=Object(n.useState)(null),l=Object(d.a)(c,2),o=l[0],i=l[1],m=Object(n.useState)(!1),u=Object(d.a)(m,2),f=u[0],b=u[1],g=Object(n.useState)(!1),E=Object(d.a)(g,2),h=E[0],p=E[1],v=Object(n.useState)([]),O=Object(d.a)(v,2),C=O[0],j=O[1],k=Object(n.useState)([]),w=Object(d.a)(k,2),x=w[0],L=w[1];function P(e,a){F=e,T=a,S.set("fimme-token",a),p(!0)}function V(){W&&W.close(),W=null,N=null,F=null,T=null,I=!1,b(!1),p(!1),j([]),L([]),S.remove("fimme-token"),t("Logged out.")}function _(e,a){var t="authenticate"===e?null:F;I&&W.send(JSON.stringify({token:t,channel:e,data:a}))}Object(n.useEffect)((function(){z(N)}),[]);var z=function(e){var n=e||N;n&&""!==n&&(N=n,(W=new WebSocket(n)).onopen=function(){clearInterval(U),t("Connected to the server."),b(!0),I=!0,S.set("fimme-server",N);var e=S.get("fimme-token");e&&_("authenticate",e)},W.onmessage=function(e){var a=JSON.parse(e.data);switch(a.channel){case"admin-login-accepted":P(a.data.accessToken,a.data.refreshToken),J(),q();break;case"admin-login-denied":t("Login denied. Please check your credentials."),p(!1);break;case"authenticated":P(a.data.accessToken,a.data.refreshToken),o&&(_(o.channel,o.data),i(null)),J(),q();break;case"unauthenticated":"authenticate"!==a.data.channel?(i(a.data),_("authenticate",T)):V();break;case"users-list":j(a.data);break;case"connections-list":L(a.data);break;case"register-accepted":t("User created."),_("fetch-users","");break;case"user-removed":t("User removed."),_("fetch-users","");break;case"logged-out":V()}},W.onclose=function(){t("Connection with server failed. Trying to reconnect..."),b(!1),I=!1,clearInterval(U),U=setInterval(z.bind(a,N),2e3)})},q=function(){_("fetch-users","")},J=function(){_("fetch-connections","")};return r.a.createElement(y.Provider,{value:{users:C,connections:x,connected:f,loggedIn:h,lastUrl:N,connect:function(e){return z(e)},login:function(e,a){return function(e,a){_("request-admin-login",{username:e,password:a})}(e,a)},logout:function(){_("request-logout",T)},createUser:function(e,a){return function(e,a){_("request-register",{username:e,password:a})}(e,a)},changePassword:function(e,a){return function(e,a){_("change-password",{username:e,password:a})}(e,a)},removeUser:function(e){return function(e){_("remove-user",e)}(e)},refreshUsers:function(){return q()},refreshConnections:function(){return J()}}},e.children)}var P=y.Consumer,V=Object(b.a)((function(e){return{root:{flexGrow:1},title:{flexGrow:1},tabs:Object(f.a)(Object(f.a)({},e.mixins.toolbar),{},{marginRight:e.spacing(2)})}}));function _(){var e,a=Object(i.g)(),t=Object(i.h)(),c=V(),l=Object(n.useContext)(y),o=Object(n.useState)(null),m=Object(d.a)(o,2),u=m[0],s=m[1],f=Boolean(u);switch(t.pathname){case"/connections":e=0;break;case"/users":e=1}return r.a.createElement(E.a,{className:c.root,position:"static"},r.a.createElement(h.a,null,r.a.createElement(g.a,{variant:"h6",className:c.title},"Fimme Administration Console"),r.a.createElement(p.a,{className:c.tabs,value:e},r.a.createElement(v.a,{className:c.tabs,label:"Connections",onClick:function(){a.push("/fimme-admin/connections")}}),r.a.createElement(v.a,{className:c.tabs,label:"Users",onClick:function(){a.push("/fimme-admin/users")}})),r.a.createElement(O.a,{color:"inherit",onClick:function(e){s(e.currentTarget)}},r.a.createElement(w.a,null)),r.a.createElement(j.a,{keepMounted:!0,id:"menu-appbar",anchorEl:u,open:f,onClose:function(){s(null)}},r.a.createElement(C.a,{onClick:function(){l.logout(),a.push("/fimme-admin/login"),s(null)}},"Log out"))))}var z=t(108),q=t(159),J=t(171),B=t(160),A=Object(b.a)((function(e){return{paper:{margin:"auto",marginTop:e.spacing(4),padding:e.spacing(2),maxWidth:480},button:{height:56}}}));function G(){var e=A(),a=Object(n.useContext)(y),t=Object(n.useState)(a.lastUrl),c=Object(d.a)(t,2),l=c[0],o=c[1],i=Object(n.useState)(""),m=Object(d.a)(i,2),u=m[0],s=m[1],f=Object(n.useState)(""),b=Object(d.a)(f,2),g=b[0],E=b[1];return r.a.createElement(z.a,{className:e.paper},r.a.createElement(q.a,{container:!0,spacing:2,direction:"column"},r.a.createElement(q.a,{item:!0},r.a.createElement(q.a,{container:!0,spacing:2},r.a.createElement(q.a,{item:!0,xs:9},r.a.createElement(J.a,{fullWidth:!0,variant:"outlined",id:"server",label:"Server URL",defaultValue:l,onChange:function(e){o(e.target.value)}})),r.a.createElement(q.a,{item:!0,xs:3},r.a.createElement(B.a,{className:e.button,variant:"contained",color:"primary",fullWidth:!0,size:"large",onClick:a.connect.bind(this,l)},a.connected?"Connected":"Connect")))),r.a.createElement(q.a,{item:!0},r.a.createElement(J.a,{fullWidth:!0,variant:"outlined",id:"username",label:"Username",defaultValue:u,onChange:function(e){s(e.target.value)}})),r.a.createElement(q.a,{item:!0},r.a.createElement(J.a,{fullWidth:!0,variant:"outlined",id:"password",type:"password",label:"Password",defaultValue:g,onChange:function(e){E(e.target.value)}})),r.a.createElement(q.a,{item:!0},r.a.createElement(B.a,{className:e.button,variant:"contained",color:"primary",fullWidth:!0,size:"large",disabled:!a.connected,onClick:a.login.bind(this,u,g)},"Log in"))))}var R=t(4),D=t(165),M=t(167),H=t(161),K=t(164),Q=t(166),X=t(162),Y=t(163),Z=t(56),$=t.n(Z),ee=Object(R.a)((function(e){return{head:{backgroundColor:e.palette.primary.main,color:e.palette.common.white},body:{fontSize:14}}}))(H.a),ae=Object(R.a)((function(e){return{root:{"&:nth-of-type(odd)":{backgroundColor:e.palette.action.hover}}}}))(X.a),te=Object(b.a)((function(e){return{root:{margin:"auto",marginTop:e.spacing(4),minWidth:480,maxWidth:800},fab:{position:"absolute",bottom:e.spacing(4),right:e.spacing(4)}}}));function ne(){var e=te(),a=Object(n.useContext)(y);return r.a.createElement(r.a.Fragment,null,r.a.createElement(Y.a,{className:e.fab,color:"primary",disabled:!a.connected,onClick:a.refreshConnections.bind(this)},r.a.createElement($.a,null)),r.a.createElement(K.a,{component:z.a,className:e.root},r.a.createElement(D.a,null,r.a.createElement(Q.a,null,r.a.createElement(X.a,null,r.a.createElement(ee,null,"Timestamp"),r.a.createElement(ee,{align:"right"},"Client A's coordinates"),r.a.createElement(ee,{align:"right"},"Client B's coordinates"))),r.a.createElement(M.a,null,a.connections.map((function(e,a){return r.a.createElement(ae,{key:a},r.a.createElement(ee,{component:"th",scope:"row"},new Date(1e3*e.timestamp).toLocaleString()),r.a.createElement(ee,{align:"right"},"lat: ",e.a_lat," lon: ",e.a_lon," alt: ",e.a_alt),r.a.createElement(ee,{align:"right"},"lat: ",e.b_lat," lon: ",e.b_lon," alt: ",e.b_alt))}))))))}var re=t(75),ce=t.n(re),le=Object(b.a)((function(e){return{paper:{margin:"auto",marginTop:e.spacing(4),minWidth:480,maxWidth:800},inner:{padding:e.spacing(2)},button:{height:56}}}));function oe(){var e=le(),a=Object(n.useContext)(y),t=Object(n.useState)(""),c=Object(d.a)(t,2),l=c[0],o=c[1],i=Object(n.useState)(""),m=Object(d.a)(i,2),u=m[0],s=m[1];return r.a.createElement(z.a,{className:e.paper},r.a.createElement(q.a,{container:!0},r.a.createElement(q.a,{className:e.inner,container:!0,item:!0,spacing:2},r.a.createElement(q.a,{item:!0,xs:12},r.a.createElement(g.a,null,"Create a new user")),r.a.createElement(q.a,{item:!0,xs:4},r.a.createElement(J.a,{fullWidth:!0,variant:"outlined",id:"username",label:"Username",defaultValue:l,onChange:function(e){o(e.target.value)}})),r.a.createElement(q.a,{item:!0,xs:4},r.a.createElement(J.a,{fullWidth:!0,variant:"outlined",id:"password",label:"Password",defaultValue:u,onChange:function(e){s(e.target.value)}})),r.a.createElement(q.a,{item:!0,xs:4},r.a.createElement(B.a,{className:e.button,variant:"contained",color:"primary",fullWidth:!0,size:"large",disabled:!a.connected,onClick:function(){""!==l&&""!==u&&a.createUser(l,u)}},"Create")))))}var ie=t(74),me=t.n(ie),ue=t(174),se=t(169),de=t(168);function fe(e){var a=e.username,t=Object(n.useContext)(y),c=Object(n.useState)(!1),l=Object(d.a)(c,2),o=l[0],i=l[1],m=Object(n.useState)(""),u=Object(d.a)(m,2),s=u[0],f=u[1],b=function(){i(!1)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(O.a,{disabled:!t.connected,onClick:function(){i(!0)}},r.a.createElement(me.a,null)),r.a.createElement(ue.a,{open:o,onClose:b},r.a.createElement(de.a,null,r.a.createElement(J.a,{fullWidth:!0,autoFocus:!0,id:"password",label:"New password",defaultValue:s,onChange:function(e){f(e.target.value)}})),r.a.createElement(se.a,null,r.a.createElement(B.a,{onClick:b,color:"primary"},"Cancel"),r.a.createElement(B.a,{onClick:function(){t.changePassword(a,s),i(!1)},color:"primary"},"Change"))))}var be=Object(R.a)((function(e){return{head:{backgroundColor:e.palette.primary.main,color:e.palette.common.white},body:{fontSize:14}}}))(H.a),ge=Object(R.a)((function(e){return{root:{"&:nth-of-type(odd)":{backgroundColor:e.palette.action.hover}}}}))(X.a),Ee=Object(b.a)((function(e){return{root:{margin:"auto",marginTop:e.spacing(4),minWidth:480,maxWidth:800},rightCell:{width:48,padding:0},fab:{position:"absolute",bottom:e.spacing(4),right:e.spacing(4)}}}));function he(){var e=this,a=Ee(),t=Object(n.useContext)(y),c=function(e){t.removeUser(e)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(Y.a,{className:a.fab,color:"primary",disabled:!t.connected,onClick:t.refreshUsers},r.a.createElement($.a,null)),r.a.createElement(oe,null),r.a.createElement(K.a,{component:z.a,className:a.root},r.a.createElement(D.a,null,r.a.createElement(Q.a,null,r.a.createElement(X.a,null,r.a.createElement(be,null,"Username"),r.a.createElement(be,null),r.a.createElement(be,null))),r.a.createElement(M.a,null,t.users.map((function(n,l){return r.a.createElement(ge,{key:l},r.a.createElement(be,{component:"th",scope:"row"},n.username),r.a.createElement(be,{className:a.rightCell,align:"right"},r.a.createElement(fe,{username:n.username})),r.a.createElement(be,{className:a.rightCell,align:"right"},r.a.createElement(O.a,{disabled:!t.connected,onClick:c.bind(e,n.username)},r.a.createElement(ce.a,null))))}))))))}var pe=Object(m.a)({palette:{primary:{main:"#6200EE"},secondary:{main:"#FFFFFF"}}});function ve(){return r.a.createElement(u.a,{theme:pe},r.a.createElement(s.a,null,r.a.createElement(L,null,r.a.createElement(P,null,(function(e){var a=e.loggedIn;return r.a.createElement(o.a,null,r.a.createElement(i.d,null,r.a.createElement(i.b,{exact:!0,path:"/fimme-admin"},a?r.a.createElement(i.a,{to:"/fimme-admin/connections"}):r.a.createElement(i.a,{to:"/fimme-admin/login"})),r.a.createElement(i.b,{exact:!0,path:"/fimme-admin/login"},r.a.createElement(G,null),a&&r.a.createElement(i.a,{to:"/fimme-admin/connections"})),r.a.createElement(i.b,{exact:!0,path:"/fimme-admin/connections"},r.a.createElement(_,null),r.a.createElement(ne,null),!a&&r.a.createElement(i.a,{to:"/fimme-admin/login"})),r.a.createElement(i.b,{exact:!0,path:"/fimme-admin/users"},r.a.createElement(_,null),r.a.createElement(he,null),!a&&r.a.createElement(i.a,{to:"/fimme-admin/login"}))))})))))}l.a.render(r.a.createElement(ve,null),document.getElementById("root"))},95:function(e,a,t){e.exports=t(107)}},[[95,1,2]]]);
//# sourceMappingURL=main.72da675d.chunk.js.map
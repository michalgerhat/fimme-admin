(this["webpackJsonpfimme-admin"]=this["webpackJsonpfimme-admin"]||[]).push([[0],{100:function(e,t,a){},107:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(8),l=a.n(c),o=(a(100),a(62)),i=a(29),u=a(76),s=a(170),m=a(57),d=a(14),b=a(65),f=a(153),g=a(156),E=a(154),h=a(155),p=a(172),v=a(157),O=a(158),C=a(175),j=a(77),k=a(73),w=a.n(k),x=a(78),y=Object(n.createContext)(),S=new x.a,N=S.get("fimme-server"),W=null,U=null,F=null,T=S.get("fimme-token"),I=!1;function L(e){var t=this,a=Object(m.b)().enqueueSnackbar,c=Object(n.useState)(null),l=Object(d.a)(c,2),o=l[0],i=l[1],u=Object(n.useState)(!1),s=Object(d.a)(u,2),b=s[0],f=s[1],g=Object(n.useState)(!1),E=Object(d.a)(g,2),h=E[0],p=E[1],v=Object(n.useState)([]),O=Object(d.a)(v,2),C=O[0],j=O[1],k=Object(n.useState)([]),w=Object(d.a)(k,2),x=w[0],L=w[1];function P(e,t){F=e,T=t,S.set("fimme-token",t),p(!0)}function V(){W&&W.close(),W=null,N=null,F=null,T=null,I=!1,f(!1),p(!1),j([]),L([]),S.remove("fimme-token"),a("Logged out.")}function _(e,t){var a="authenticate"===e?null:F;I&&W.send(JSON.stringify({token:a,channel:e,data:t}))}Object(n.useEffect)((function(){z(N)}),[]);var z=function(e){var n=e||N;n&&""!==n&&(N=n,(W=new WebSocket(n)).onopen=function(){clearInterval(U),a("Connected to the server."),f(!0),I=!0,S.set("fimme-server",N);var e=S.get("fimme-token");e&&_("authenticate",e)},W.onmessage=function(e){var t=JSON.parse(e.data);switch(t.channel){case"admin-login-accepted":P(t.data.accessToken,t.data.refreshToken),J(),q();break;case"admin-login-denied":a("Login denied. Please check your credentials."),p(!1);break;case"authenticated":P(t.data.accessToken,t.data.refreshToken),o&&(_(o.channel,o.data),i(null)),J(),q();break;case"unauthenticated":"authenticate"!==t.data.channel?(i(t.data),_("authenticate",T)):V();break;case"users-list":j(t.data);break;case"connections-list":L(t.data);break;case"register-accepted":a("User created."),_("fetch-users","");break;case"user-removed":a("User removed."),_("fetch-users","");break;case"logged-out":V()}},W.onclose=function(){a("Connection with server failed. Trying to reconnect..."),f(!1),I=!1,clearInterval(U),U=setInterval(z.bind(t,N),2e3)})},q=function(){_("fetch-users","")},J=function(){_("fetch-connections","")};return r.a.createElement(y.Provider,{value:{users:C,connections:x,connected:b,loggedIn:h,lastUrl:N,connect:function(e){return z(e)},login:function(e,t){return function(e,t){_("request-admin-login",{username:e,password:t})}(e,t)},logout:function(){_("request-logout",T)},createUser:function(e,t){return function(e,t){_("request-register",{username:e,password:t})}(e,t)},changePassword:function(e,t){return function(e,t){_("change-password",{username:e,password:t})}(e,t)},removeUser:function(e){return function(e){_("remove-user",e)}(e)},refreshUsers:function(){return q()},refreshConnections:function(){return J()}}},e.children)}var P=y.Consumer,V=Object(f.a)((function(e){return{root:{flexGrow:1},title:{flexGrow:1},tabs:Object(b.a)(Object(b.a)({},e.mixins.toolbar),{},{marginRight:e.spacing(2)})}}));function _(){var e,t=Object(i.g)(),a=Object(i.h)(),c=V(),l=Object(n.useContext)(y),o=Object(n.useState)(null),u=Object(d.a)(o,2),s=u[0],m=u[1],b=Boolean(s);switch(a.pathname){case"/connections":e=0;break;case"/users":e=1}return r.a.createElement(E.a,{className:c.root,position:"static"},r.a.createElement(h.a,null,r.a.createElement(g.a,{variant:"h6",className:c.title},"Fimme Administration Console"),r.a.createElement(p.a,{className:c.tabs,value:e},r.a.createElement(v.a,{className:c.tabs,label:"Connections",onClick:function(){t.push("/connections")}}),r.a.createElement(v.a,{className:c.tabs,label:"Users",onClick:function(){t.push("/users")}})),r.a.createElement(O.a,{color:"inherit",onClick:function(e){m(e.currentTarget)}},r.a.createElement(w.a,null)),r.a.createElement(j.a,{keepMounted:!0,id:"menu-appbar",anchorEl:s,open:b,onClose:function(){m(null)}},r.a.createElement(C.a,{onClick:function(){l.logout(),t.push("/login"),m(null)}},"Log out"))))}var z=a(108),q=a(159),J=a(171),B=a(160),A=Object(f.a)((function(e){return{paper:{margin:"auto",marginTop:e.spacing(4),padding:e.spacing(2),maxWidth:480},button:{height:56}}}));function G(){var e=A(),t=Object(n.useContext)(y),a=Object(n.useState)(t.lastUrl),c=Object(d.a)(a,2),l=c[0],o=c[1],i=Object(n.useState)(""),u=Object(d.a)(i,2),s=u[0],m=u[1],b=Object(n.useState)(""),f=Object(d.a)(b,2),g=f[0],E=f[1];return r.a.createElement(z.a,{className:e.paper},r.a.createElement(q.a,{container:!0,spacing:2,direction:"column"},r.a.createElement(q.a,{item:!0},r.a.createElement(q.a,{container:!0,spacing:2},r.a.createElement(q.a,{item:!0,xs:9},r.a.createElement(J.a,{fullWidth:!0,variant:"outlined",id:"server",label:"Server URL",defaultValue:l,onChange:function(e){o(e.target.value)}})),r.a.createElement(q.a,{item:!0,xs:3},r.a.createElement(B.a,{className:e.button,variant:"contained",color:"primary",fullWidth:!0,size:"large",onClick:t.connect.bind(this,l)},t.connected?"Connected":"Connect")))),r.a.createElement(q.a,{item:!0},r.a.createElement(J.a,{fullWidth:!0,variant:"outlined",id:"username",label:"Username",defaultValue:s,onChange:function(e){m(e.target.value)}})),r.a.createElement(q.a,{item:!0},r.a.createElement(J.a,{fullWidth:!0,variant:"outlined",id:"password",type:"password",label:"Password",defaultValue:g,onChange:function(e){E(e.target.value)}})),r.a.createElement(q.a,{item:!0},r.a.createElement(B.a,{className:e.button,variant:"contained",color:"primary",fullWidth:!0,size:"large",disabled:!t.connected,onClick:t.login.bind(this,s,g)},"Log in"))))}var R=a(4),D=a(165),M=a(167),H=a(161),K=a(164),Q=a(166),X=a(162),Y=a(163),Z=a(56),$=a.n(Z),ee=Object(R.a)((function(e){return{head:{backgroundColor:e.palette.primary.main,color:e.palette.common.white},body:{fontSize:14}}}))(H.a),te=Object(R.a)((function(e){return{root:{"&:nth-of-type(odd)":{backgroundColor:e.palette.action.hover}}}}))(X.a),ae=Object(f.a)((function(e){return{root:{margin:"auto",marginTop:e.spacing(4),minWidth:480,maxWidth:800},fab:{position:"absolute",bottom:e.spacing(4),right:e.spacing(4)}}}));function ne(){var e=ae(),t=Object(n.useContext)(y);return r.a.createElement(r.a.Fragment,null,r.a.createElement(Y.a,{className:e.fab,color:"primary",disabled:!t.connected,onClick:t.refreshConnections.bind(this)},r.a.createElement($.a,null)),r.a.createElement(K.a,{component:z.a,className:e.root},r.a.createElement(D.a,null,r.a.createElement(Q.a,null,r.a.createElement(X.a,null,r.a.createElement(ee,null,"Timestamp"),r.a.createElement(ee,{align:"right"},"Client A's coordinates"),r.a.createElement(ee,{align:"right"},"Client B's coordinates"))),r.a.createElement(M.a,null,t.connections.map((function(e,t){return r.a.createElement(te,{key:t},r.a.createElement(ee,{component:"th",scope:"row"},new Date(1e3*e.timestamp).toLocaleString()),r.a.createElement(ee,{align:"right"},"lat: ",e.a_lat," lon: ",e.a_lon," alt: ",e.a_alt),r.a.createElement(ee,{align:"right"},"lat: ",e.b_lat," lon: ",e.b_lon," alt: ",e.b_alt))}))))))}var re=a(75),ce=a.n(re),le=Object(f.a)((function(e){return{paper:{margin:"auto",marginTop:e.spacing(4),minWidth:480,maxWidth:800},inner:{padding:e.spacing(2)},button:{height:56}}}));function oe(){var e=le(),t=Object(n.useContext)(y),a=Object(n.useState)(""),c=Object(d.a)(a,2),l=c[0],o=c[1],i=Object(n.useState)(""),u=Object(d.a)(i,2),s=u[0],m=u[1];return r.a.createElement(z.a,{className:e.paper},r.a.createElement(q.a,{container:!0},r.a.createElement(q.a,{className:e.inner,container:!0,item:!0,spacing:2},r.a.createElement(q.a,{item:!0,xs:12},r.a.createElement(g.a,null,"Create a new user")),r.a.createElement(q.a,{item:!0,xs:4},r.a.createElement(J.a,{fullWidth:!0,variant:"outlined",id:"username",label:"Username",defaultValue:l,onChange:function(e){o(e.target.value)}})),r.a.createElement(q.a,{item:!0,xs:4},r.a.createElement(J.a,{fullWidth:!0,variant:"outlined",id:"password",label:"Password",defaultValue:s,onChange:function(e){m(e.target.value)}})),r.a.createElement(q.a,{item:!0,xs:4},r.a.createElement(B.a,{className:e.button,variant:"contained",color:"primary",fullWidth:!0,size:"large",disabled:!t.connected,onClick:function(){""!==l&&""!==s&&t.createUser(l,s)}},"Create")))))}var ie=a(74),ue=a.n(ie),se=a(174),me=a(169),de=a(168);function be(e){var t=e.username,a=Object(n.useContext)(y),c=Object(n.useState)(!1),l=Object(d.a)(c,2),o=l[0],i=l[1],u=Object(n.useState)(""),s=Object(d.a)(u,2),m=s[0],b=s[1],f=function(){i(!1)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(O.a,{disabled:!a.connected,onClick:function(){i(!0)}},r.a.createElement(ue.a,null)),r.a.createElement(se.a,{open:o,onClose:f},r.a.createElement(de.a,null,r.a.createElement(J.a,{fullWidth:!0,autoFocus:!0,id:"password",label:"New password",defaultValue:m,onChange:function(e){b(e.target.value)}})),r.a.createElement(me.a,null,r.a.createElement(B.a,{onClick:f,color:"primary"},"Cancel"),r.a.createElement(B.a,{onClick:function(){a.changePassword(t,m),i(!1)},color:"primary"},"Change"))))}var fe=Object(R.a)((function(e){return{head:{backgroundColor:e.palette.primary.main,color:e.palette.common.white},body:{fontSize:14}}}))(H.a),ge=Object(R.a)((function(e){return{root:{"&:nth-of-type(odd)":{backgroundColor:e.palette.action.hover}}}}))(X.a),Ee=Object(f.a)((function(e){return{root:{margin:"auto",marginTop:e.spacing(4),minWidth:480,maxWidth:800},rightCell:{width:48,padding:0},fab:{position:"absolute",bottom:e.spacing(4),right:e.spacing(4)}}}));function he(){var e=this,t=Ee(),a=Object(n.useContext)(y),c=function(e){a.removeUser(e)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(Y.a,{className:t.fab,color:"primary",disabled:!a.connected,onClick:a.refreshUsers},r.a.createElement($.a,null)),r.a.createElement(oe,null),r.a.createElement(K.a,{component:z.a,className:t.root},r.a.createElement(D.a,null,r.a.createElement(Q.a,null,r.a.createElement(X.a,null,r.a.createElement(fe,null,"Username"),r.a.createElement(fe,null),r.a.createElement(fe,null))),r.a.createElement(M.a,null,a.users.map((function(n,l){return r.a.createElement(ge,{key:l},r.a.createElement(fe,{component:"th",scope:"row"},n.username),r.a.createElement(fe,{className:t.rightCell,align:"right"},r.a.createElement(be,{username:n.username})),r.a.createElement(fe,{className:t.rightCell,align:"right"},r.a.createElement(O.a,{disabled:!a.connected,onClick:c.bind(e,n.username)},r.a.createElement(ce.a,null))))}))))))}var pe=Object(u.a)({palette:{primary:{main:"#6200EE"},secondary:{main:"#FFFFFF"}}});function ve(){return r.a.createElement(s.a,{theme:pe},r.a.createElement(m.a,null,r.a.createElement(L,null,r.a.createElement(P,null,(function(e){var t=e.loggedIn;return r.a.createElement(o.a,null,r.a.createElement(i.d,null,r.a.createElement(i.b,{exact:!0,path:"/"},t?r.a.createElement(i.a,{to:"/connections"}):r.a.createElement(i.a,{to:"/login"})),r.a.createElement(i.b,{exact:!0,path:"/login"},r.a.createElement(G,null),t&&r.a.createElement(i.a,{to:"/connections"})),r.a.createElement(i.b,{exact:!0,path:"/connections"},r.a.createElement(_,null),r.a.createElement(ne,null),!t&&r.a.createElement(i.a,{to:"/login"})),r.a.createElement(i.b,{exact:!0,path:"/users"},r.a.createElement(_,null),r.a.createElement(he,null),!t&&r.a.createElement(i.a,{to:"/login"}))))})))))}l.a.render(r.a.createElement(ve,null),document.getElementById("root"))},95:function(e,t,a){e.exports=a(107)}},[[95,1,2]]]);
//# sourceMappingURL=main.4adc8770.chunk.js.map